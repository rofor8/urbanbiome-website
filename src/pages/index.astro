---
// 1. Import the necessary functions and components
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import TeamGrid from '@/components/TeamGrid.astro';
import ContactForm from '@/components/ContactForm.astro';

// 2. Fetch all entries from the "sections" collection
const allSections = await getCollection('sections');

// 3. Sort the entries by the 'order' property in their frontmatter
allSections.sort((a, b) => (a.data.order || 99) - (b.data.order || 99));

// Helper function to create a URL-friendly slug from a title
const slugify = (text: string) => text.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');

// Map of component names to actual components
const componentMap: Record<string, any> = {
  'TeamGrid': TeamGrid,
  'ContactForm': ContactForm,
};
---

<BaseLayout title="UrbanBiome - Geospatial Analytics Software Platform">
	<header class="hero">
        <h1>Environmental Intelligence Platform</h1>
        <p class="hero-subtitle">Like a medical scan for the Earth - revealing hidden patterns in urban ecosystem health through satellite data analysis</p>
        <div class="hero-cta">
            <a href="/pricing" class="cta-button primary">View Pricing</a>
            <a href="https://auth.urbanbiome.co.uk" class="cta-button secondary">Try Platform</a>
        </div>
    </header>

    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">UrbanBiome</a>
            <ul class="nav-links">
                <!-- Content sections navigation -->
                {allSections.map(section => {
                    const navText = section.data.navTitle || section.data.title;
                    return (
                        <li><a href={`#${slugify(section.data.title)}`}>{navText}</a></li>
                    )
                })}
                <!-- Legal pages navigation -->
                <li><a href="/pricing">Pricing</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle">Legal</a>
                    <ul class="dropdown-menu">
                        <li><a href="/terms">Terms of Service</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/refund">Refund Policy</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <main>
        <!-- Loop through the sections again to create the content blocks -->
        {allSections.map(async (section) => {
            // Get the rendered <Content /> component for each section
            const { Content } = await section.render();
            const sectionId = slugify(section.data.title);
            // This line checks if 'centered: true' is in the frontmatter
            const contentClass = section.data.centered ? 'content-wrapper centered' : 'content-wrapper';

            // Check if this section should use a component
            const Component = section.data.useComponent ? componentMap[section.data.useComponent] : null;

            return (
                <section id={sectionId}>
                    <div class="container">
                        <div class="section-header">
                            <h2>{section.data.title}</h2>
                        </div>
                        {/* The 'centered' class is now added dynamically */}
                        <div class={contentClass}>
                             <!-- This renders the Markdown content -->
                            <Content />
                            <!-- If a component is specified, render it after the markdown -->
                            {Component && <Component />}
                        </div>
                    </div>
                </section>
            )
        })}
    </main>

    <!-- Software/SaaS Emphasis Section -->
    <section class="software-emphasis">
        <div class="container">
            <h2>Professional Geospatial Software Platform</h2>
            <p>UrbanBiome provides advanced software-as-a-service (SaaS) solutions for geospatial analysis, urban planning, and environmental monitoring. Our cloud-based platform delivers sophisticated analytical tools through secure web interfaces.</p>
            
            <div class="features-grid">
                <div class="feature">
                    <h3>üõ∞Ô∏è Satellite Data Processing</h3>
                    <p>Advanced software algorithms for real-time satellite imagery analysis and temporal data visualization</p>
                </div>
                <div class="feature">
                    <h3>üìä Analytics Dashboard</h3>
                    <p>Web-based analytical tools with WASM-powered spatial aggregation and professional reporting</p>
                </div>
                <div class="feature">
                    <h3>üîå API Platform</h3>
                    <p>RESTful APIs and SDK for custom integrations with enterprise planning systems</p>
                </div>
                <div class="feature">
                    <h3>‚òÅÔ∏è Cloud Infrastructure</h3>
                    <p>Scalable SaaS platform with enterprise-grade security, SOC2 compliance, and global accessibility</p>
                </div>
            </div>
            
            <div class="contact-info">
                <h3>Contact Information</h3>
                <p><strong>Company:</strong> UrbanBiome Ltd</p>
                <p><strong>Email:</strong> support@urbanbiome.co.uk</p>
                <p><strong>Address:</strong> Bristol, United Kingdom</p>
                <p><strong>Business Type:</strong> B2B SaaS Software Platform</p>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>UrbanBiome Ltd</h4>
                    <p>Professional geospatial analytics software platform</p>
                    <p>support@urbanbiome.co.uk</p>
                </div>
                <div class="footer-section">
                    <h4>Product</h4>
                    <ul>
                        <li><a href="/pricing">Pricing</a></li>
                        <li><a href="https://auth.urbanbiome.co.uk">Platform Access</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Legal</h4>
                    <ul>
                        <li><a href="/terms">Terms of Service</a></li>
                        <li><a href="/privacy">Privacy Policy</a></li>
                        <li><a href="/refund">Refund Policy</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 UrbanBiome Ltd. All rights reserved. | Software-as-a-Service Platform</p>
            </div>
        </div>
    </footer>
</BaseLayout>
