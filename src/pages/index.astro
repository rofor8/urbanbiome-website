---
// Changed the import path to be more robust
import Layout from '@/layouts/Layout.astro';
import MapIframe from '@/components/MapIframe.astro';

// 1. Import all markdown files
const allSections = await Astro.glob('../sections/*.md');

// 2. Sort the sections based on the 'order' property in the frontmatter
allSections.sort((a, b) => (a.frontmatter.order || 99) - (b.frontmatter.order || 99));

// Helper function to create a URL-friendly slug from a title
const slugify = (text: string) => text.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
---

<Layout title="UrbanBiome - Reimagining Cities, Naturally.">
	<header class="hero">
        <h1>Breathing Life Into Urban Spaces.</h1>
    </header>

    <nav class="navbar">
        <div class="container">
            <a href="#" class="logo">UrbanBiome</a>
            <ul class="nav-links">
                <!-- Loop through the SORTED sections to create nav links -->
                {allSections.map(section => {
                    const navText = section.frontmatter.navTitle || section.frontmatter.title;
                    return (
                        <li><a href={`#${slugify(section.frontmatter.title)}`}>{navText}</a></li>
                    )
                })}
            </ul>
        </div>
    </nav>

    <main>
        <!-- Loop through the sections again to create the content blocks -->
        {allSections.map(section => {
            const { Content } = section;
            const sectionId = slugify(section.frontmatter.title);
            return (
                <section id={sectionId}>
                    <div class="container">
                        <div class="section-header">
                            <h2>{section.frontmatter.title}</h2>
                        </div>
                        <div class="content-wrapper">
                             <!-- The <Content /> component correctly renders Markdown -->
                            <Content />
                        </div>
                    </div>
                </section>
            )
        })}
    </main>

    <footer class="footer">
        <div class="container">
            <p>UrbanBiome</p>
            <p>Â© 2025 UrbanBiome. All rights reserved.</p>
        </div>
    </footer>
</Layout>
